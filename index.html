<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MSP Course & Lab Selector</title>

<!-- UM Web Font -->
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Source Sans Pro', sans-serif;
        margin: 0;
        background-color: #F5F5F5;
        color: #011B3C; /* UM dark blue */
    }

    /* ====== CONTAINER ====== */
    .container {
        max-width: 1200px;
        margin: auto;
        background: white;
    }

    /* ====== HEADER ====== */
    .main-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #011B3C; /* UM dark blue */
        color: white;
        padding: 15px 40px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }

    .main-header h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 700;
    }

    .subtitle {
        margin: 4px 0 0 0;
        font-size: 15px;
        font-weight: 300;
    }

    .logo {
        height: 60px;
    }

    .header-center {
        text-align: center;
        flex-grow: 1;
    }

    .header-left, .header-right {
        width: 140px;
    }

    /* ====== TABS ====== */
    .tabs {
        display: flex;
        background-color: #011B3C; /* UM dark blue */
    }

    .tab-button {
        flex: 1;
        padding: 14px;
        border: none;
        background: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
        font-weight: 600;
    }

    .tab-button:hover {
        background-color: #6ED2EC; /* Sky Blue */
        color: #011B3C;
    }

    .tab-button.active {
        background-color: #6ED2EC; /* Sky Blue */
        color: #011B3C; /* Dark blue text for contrast */
    }

    /* ====== CONTENT ====== */
    .tab-content {
        display: none;
        padding: 30px 40px;
    }

    .tab-content.active {
        display: block;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
        font-size: 14px;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }

    th {
        background-color: #F5F5F5;
        font-weight: 600;
        color: #011B3C;
    }

    select, input[type=file], button {
        padding: 8px;
        margin: 10px 0;
        width: 320px;
        font-size: 14px;
    }

    button {
        background-color: #F39237;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
    }

    button:hover {
        opacity: 0.85;
    }

    .result {
        margin-top: 25px;
        font-weight: 700;
        font-size: 18px;
        color: #F39237;
    }

    /* ====== COURSE SLOT COLORS ====== */
    .slot-A { background-color: #FFE0C2; } /* light orange */
    .slot-B { background-color: #FFD1A6; }
    .slot-C { background-color: #FFB980; }
    .slot-D { background-color: #FFA05A; }
    .slot-E { background-color: #F39237; } /* main orange */

    /* Force text color to black in selection tab courses table */
    #selection table tr.slot-A,
    #selection table tr.slot-B,
    #selection table tr.slot-C,
    #selection table tr.slot-D,
    #selection table tr.slot-E {
        color: black;
    }
</style>
</head>

<body>

<div class="container">

<header class="main-header">
    <div class="header-left">
        <img src="UM-logo.jpg" alt="UM Logo" class="logo">
    </div>
    <div class="header-center">
        <h1>MSP Course & Lab Selector</h1>
        <p class="subtitle">Maastricht Science Programme</p>
    </div>
    <div class="header-right">
        <img src="MSP-logo.jpg" alt="MSP Logo" class="logo">
    </div>
</header>

<div class="tabs">
    <button class="tab-button active" onclick="openTab('config', this)">Configuration</button>
    <button class="tab-button" onclick="openTab('courses', this)">All Courses</button>
    <button class="tab-button" onclick="openTab('labs', this)">All Labs</button>
    <button class="tab-button" onclick="openTab('selection', this)">Selection Tool</button>
</div>

<!-- ===== CONFIGURATION TAB ===== -->
<div id="config" class="tab-content active">
    <h2>Configuration</h2>
    <input type="file" id="csvFile" accept=".csv"><br>
    <button id="loadCsvButton">Load CSV and Populate Tables</button>
    <p>Upload the MSP CSV file. Courses have a Slot value; labs/skills have an empty Slot.</p>
</div>

<!-- ===== COURSES TAB ===== -->
<div id="courses" class="tab-content">
    <h2>All Courses</h2>
    <table id="coursesTable"></table>
</div>

<!-- ===== LABS TAB ===== -->
<div id="labs" class="tab-content">
    <h2>All Labs</h2>
    <table id="labsTable"></table>
</div>

<!-- ===== SELECTION TAB ===== -->
<div id="selection" class="tab-content">
    <h2>Select Courses</h2>

    <label>Course 1:</label><br>
    <select id="course1"><option value="">-- Choose --</option></select><br>

    <label>Course 2:</label><br>
    <select id="course2"><option value="">-- Choose --</option></select>

    <div class="result" id="labsOutput">
        Compatible labs will appear here.
    </div>
</div>

</div>

<script>
let courses = [];
let labs = [];
let uploadedCSVText = null;

const course1 = document.getElementById("course1");
const course2 = document.getElementById("course2");

function openTab(tabName, element) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    element.classList.add('active');
}

document.getElementById("csvFile").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(event) {
        uploadedCSVText = event.target.result;
        console.log("CSV file loaded.");
    };
    reader.readAsText(file);
});

document.getElementById("loadCsvButton").addEventListener("click", function() {
    if (!uploadedCSVText) {
        alert("Please select a CSV file first!");
        return;
    }
    parseCSV(uploadedCSVText);
});

function parseCSVRow(row) {
    const regex = /("([^"]*(?:""[^"]*)*)"|[^,]*)(,|$)/g;
    const result = [];
    row.replace(regex, (m, p1) => {
        let val = p1.trim();
        if(val.startsWith('"') && val.endsWith('"')) {
            val = val.slice(1, -1).replace(/""/g,'"');
        }
        result.push(val);
        return '';
    });
    return result;
}

function parseCSV(csvText) {
    courses = [];
    labs = [];

    const lines = csvText.split(/\r?\n/).filter(l => l.trim() !== "");
    const headers = parseCSVRow(lines[0]);

    for (let i = 1; i < lines.length; i++) {
        const row = parseCSVRow(lines[i]);
        if(row.length !== headers.length) continue;

        const entry = {};
        headers.forEach((h, idx) => entry[h] = row[idx]);

        entry.Corequisite = entry.Corequisite?.toUpperCase() === "TRUE";
        entry.Prerequisite = entry.Prerequisite?.toUpperCase() === "TRUE";
        entry.Days = entry.Days ? entry.Days.split(/\s*,\s*/) : [];

        if (entry.Slot) courses.push(entry);
        else labs.push(entry);
    }

    populateTables();
    populateDropdowns();
    updateLabs();
}

function populateTables() {
    let courseHTML = `<tr><th>Code</th><th>Title</th><th>Co-requisite</th><th>Pre-requisite</th><th>Days</th></tr>`;
    const slotClasses = { "A":"slot-A","B":"slot-B","C":"slot-C","D":"slot-D","E":"slot-E" };
    courses.forEach(c => {
        const cls = slotClasses[c.Slot] || "";
        courseHTML += `<tr class="${cls}">
            <td>${c.Code}</td>
            <td>${c.Title}</td>
            <td>${c.Corequisite ? "Yes" : "No"}</td>
            <td>${c.Prerequisite ? "Yes" : "No"}</td>
            <td>${c.Days.join(", ")}</td>
        </tr>`;
    });
    document.getElementById("coursesTable").innerHTML = courseHTML;

    let labHTML = `<tr><th>Code</th><th>Title</th><th>Days</th></tr>`;
    labs.forEach(l => {
        labHTML += `<tr>
            <td>${l.Code}</td>
            <td>${l.Title}</td>
            <td>${l.Days.join(", ")}</td>
        </tr>`;
    });
    document.getElementById("labsTable").innerHTML = labHTML;
}

function populateDropdowns() {
    course1.innerHTML = "<option value=''>-- Choose --</option>";
    course2.innerHTML = "<option value=''>-- Choose --</option>";

    courses.forEach(c => {
        course1.add(new Option(`${c.Code} - ${c.Title}`, c.Code));
        course2.add(new Option(`${c.Code} - ${c.Title}`, c.Code));
    });
}

function updateLabs() {
    const c1 = courses.find(c => c.Code === course1.value);
    const c2 = courses.find(c => c.Code === course2.value);

    const outputDiv = document.getElementById("labsOutput");

    if (!c1 && !c2) {
        outputDiv.innerHTML = "Compatible labs will appear here.";
        return;
    }

    const selectedDays = new Set([...(c1?.Days || []), ...(c2?.Days || [])]);

    const compatibleLabs = labs.filter(lab =>
        !lab.Days.some(day => selectedDays.has(day))
    );

    // ===== Build HTML =====
    let html = "";

    // Selected courses table
    html += "<h3>Selected Courses</h3>";
    html += `<table><tr><th>Code</th><th>Title</th><th>Co-requisite</th><th>Pre-requisite</th><th>Days</th></tr>`;
    const slotClasses = { "A":"slot-A","B":"slot-B","C":"slot-C","D":"slot-D","E":"slot-E" };
    [c1,c2].forEach(c => {
        if (c) {
            const cls = slotClasses[c.Slot] || "";
            html += `<tr class="${cls}">
                <td>${c.Code}</td>
                <td>${c.Title}</td>
                <td>${c.Corequisite ? "Yes" : "No"}</td>
                <td>${c.Prerequisite ? "Yes" : "No"}</td>
                <td>${c.Days.join(", ")}</td>
            </tr>`;
        }
    });
    html += "</table>";

    // Compatible labs table
    html += "<h3>Compatible Labs</h3>";
    if (compatibleLabs.length) {
        html += `<table><tr><th>Code</th><th>Title</th><th>Days</th></tr>`;
        compatibleLabs.forEach(l => {
            html += `<tr>
                <td>${l.Code}</td>
                <td>${l.Title}</td>
                <td>${l.Days.join(", ")}</td>
            </tr>`;
        });
        html += "</table>";
    } else {
        html += "<p>No compatible labs found.</p>";
    }

    outputDiv.innerHTML = html;
}

course1.addEventListener("change", updateLabs);
course2.addEventListener("change", updateLabs);
</script>

</body>
</html>
